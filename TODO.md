# Технический аудит и план выпуска

## Резюме проекта

- Корпоративный сайт-каталог без онлайн-продаж, где через витрину категорий, товаров, услуг и кейсов пользователи быстро понимают ценовой диапазон и сроки, а заявки фиксируются с источником и аналитикой. 【F:ТЗ.md†L2-L48】
- Управление контентом и SEO должно быть без кода через админку с page builder’ом, глобальными блоками и импортом CSV. 【F:ТЗ.md†L49-L68】

## Текущий статус

- Оценка готовности: ~70%. Есть публичные страницы каталога, услуг, портфолио, новостей, документов, контактов и поиск с автокомплитом (маршруты и контроллеры). 【F:routes/web.php†L9-L84】【F:app/Http/Controllers/PublicController.php†L31-L375】
- Реализованы формы с динамическими полями, дедупликацией лидов, уведомлениями и отслеживанием отправок, плюс серверный rate limit. 【F:app/Http/Controllers/FormController.php†L25-L224】
- Поиск агрегирует продукты, услуги, кейсы, новости и страницы через Meilisearch с подсветкой сниппетов. 【F:app/Services/SearchService.php†L23-L214】
- Админка на Orchid покрывает основные сущности (страницы, меню, контентные модули), инфраструктура описана в Makefile/Docker Compose, есть тесты и сиды. 【F:docker-compose.yml†L1-L111】
- Отсутствует часть ключевых требований: рабочая интеграция капчи, явные CTA контактов/мессенджеров с аналитикой, калькуляторы/вилки цен на публичном фронте, перенос фронтенд-логики в Vite/Tailwind.

## Найденные проблемы

- **Критические**: проверка капчи не реализована (stub для reCAPTCHA/hCaptcha), что оставляет формы без антиспама. 【F:app/Http/Controllers/FormController.php†L229-L272】
- **Архитектурные**: публичный UI собран на inline CSS/JS, минуя Vite/Tailwind пайплайн и модульность компонентов. 【F:resources/views/public/layouts/app.blade.php†L11-L200】【F:resources/views/public/layouts/app.blade.php†L498-L894】
- **Качество кода/UX**: в хедере нет контактных CTA/мессенджеров, требуемых ТЗ, а в футере статичные заглушки вместо данных из админки. 【F:resources/views/components/menu/header.blade.php†L13-L45】【F:resources/views/components/menu/footer.blade.php†L41-L54】
- **Безопасность/конфигурация**: дублирующиеся переменные TELEGRAM в `.env.example` создают риск рассинхронизации; события кликов по телефону/мессенджерам не трекаются, хотя сервис аналитики их поддерживает. 【F:.env.example†L36-L94】【F:app/Services/Analytics/EventTrackerService.php†L104-L155】

## Аудит архитектуры

- Сильные стороны: модульные сервисы (крошки, формы, поиск), разделение публичных контроллеров по доменам, наличие sitemap/robots, сиды и docker-compose для полного стека. 【F:app/Http/Controllers/PublicController.php†L31-L375】【F:docker-compose.yml†L1-L111】
- Слабые стороны: фронтенд не использует сборку и дизайн-систему, аналитика кликов не интегрирована в шаблоны, контактные данные и CTA жёстко прошиты, нет реализации ценовых «вилок»/калькуляторов на страницах.

## Детальный план доведения до релиза

[✅]1. Этап 0 — Исправление критических ошибок (Blockers)

- ✅ Внедрить реальные проверки reCAPTCHA/hCaptcha (серверные вызовы API, конфиги в env, фолыбэк при ошибках) и покрыть это фиче-тестом отправки формы. 【F:src/app/Services/CaptchaService.php】【F:src/app/Http/Controllers/FormController.php】【F:src/tests/Feature/CaptchaTest.php】【F:src/config/services.php】【F:src/.env.example】
- ⏳ Добавить трекинг отказов/ошибок капчи в логи/аналитику, чтобы видеть нагрузку спама.
- Добавить трекинг отказов/ошибок капчи в логи/аналитику, чтобы видеть нагрузку спама.

[]2. Этап 1 — Доводка базовой функциональности (Core Features)

- Собрать блоки «вилка цены/сроков» и калькулятор (form_code=calc) в публичных страницах товаров/услуг/главной с привязкой к существующим формам и UTM.
- Добавить контактные CTA в хедер/фиксированные зоны (tel, Telegram, WhatsApp) с событиями аналитики и конфигурацией из админки/настроек вместо статичных заглушек. 【F:resources/views/components/menu/header.blade.php†L13-L45】【F:resources/views/components/menu/footer.blade.php†L41-L54】
- Расширить страницы «Производственные возможности» и «Проектирование» через page builder секции, связать кейсы/товары/услуги по требованиям перелинковки.

[]3. Этап 2 — Рефакторинг и улучшение кода (Code Health)

- Перенести стили/скрипты из inline в Vite/Tailwind, разбить UI на переиспользуемые компоненты, добавить состояния ошибок/загрузки согласно UX требований. 【F:resources/views/public/layouts/app.blade.php†L11-L200】【F:resources/views/public/layouts/app.blade.php†L498-L894】
- Централизовать контактные данные/соцсети и удалить дубли в `.env.example`; добавить валидацию конфигурации и документацию. 【F:.env.example†L36-L94】
- Увеличить покрытие тестами: поиск (Meilisearch мок), slug-редиректы, sitemap/robots, формы с дедупликацией и webhooks/уведомлениями.

[]4. Этап 3 — Инфраструктура и развертывание (DevOps)

- Добавить healthcheck’и и ресурсы для сервисов в docker-compose, скрипты бэкапа/восстановления Meilisearch и медиа; актуализировать staging/prod env файлы.
- Настроить CI (phpunit, pint, composer validate, npm run build) и импорт Scout-индексов на деплое.
- Документировать продовый запуск: HTTPS/Traefik, ключи капчи, переменные аналитики, расписание бэкапов/очередей.

[]5. Этап 4 — Финальное тестирование и релиз (Testing & Release)

- Подготовить чек-лист ручных смоуков: навигация, формы (3 типа), калькулятор, поиск+autocomplete, перелинковка, NDA кейсы, документы, 404/500.
- Написать критические интеграционные тесты (формы с капчей, аналитические события, редиректы slug, экспорт заявок) и зафиксировать результаты.
- Выпустить тег релиза с сопроводительной инструкцией (настройка контента в админке, запуск импорта CSV, обновление индексов поиска).
