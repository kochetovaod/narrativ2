# План реализации админ-панели на Orchid (Laravel 11)

## Условные обозначения

[] - задача еще не выполнялась
[✓] - задача выполнена
[x] - задачу выполнить не удалось

**TODO** - необходимые дополнительные действия для выполнения задачи

## Принципы

**Инкрементальность**: Создавай минимальную рабочую версию (MVP) функции, затем улучшай.

**Контекстная проверка**: Проверяй изменения не изолированно, а в контексте всего приложения.

**Документирование как часть задачи**: Любое отклонение от стандартного пути фиксируется в списке задач (TODO).

## Алгоритм выполнения задач

Отличная структура! Ваш план уже хорош, но можно сделать алгоритм более конкретным и процессно-ориентированным. Это поможет избежать тупиковых ситуаций и повысит качество выполнения задач.

Вот предложение по улучшению раздела **«Алгоритм выполнения задач»**. Я сделал его более пошаговым и добавил принцип «инкрементальной проверки».

---

### **Алгоритм выполнения задач (обновленная версия)**

Этот алгоритм — циклический процесс для каждой задачи. Его цель — не просто «отметить задачу как выполненную», а получить **рабочий, проверенный результат, интегрированный в проект**.

**Принципы:**

* **Инкрементальность:** Создавай минимальную рабочую версию (MVP) функции, затем улучшай.
* **Контекстная проверка:** Проверяй изменения не изолированно, а в контексте всего приложения.
* **Документирование как часть задачи:** Любое отклонение от стандартного пути фиксируется в коде (комментарии) или в списке задач (`TODO`).

**Шаги:**

1. **Анализ и декомпозиция:**

    * **Прочитай задачу** полностью.
    * **Изучи контекст:** Какие сущности модели, миграции, экраны уже созданы в проекте? (`app/Models/`, `database/migrations/`, `app/Orchid/Screens/`).
    * **Сверься с ТЗ (`ТЗ.md`):** Уточни ожидаемое поведение, ограничения, бизнес-логику.
    * **Сверься с документацией Orchid (`https://orchid.software/en/docs/`):** Найди разделы, напрямую относящиеся к задаче (Layouts, Screens, Filters, Permissions и т.д.).
    * **Раздели задачу** на минимальные технические подзадачи (например: 1.1 – Создать миграцию, 1.2 – Создать модель, 1.3 – Создать экран (Screen) и т.д.). Зафиксируй подзадачи в списке.

2. **Планирование реализации:**
    * Определи, какие файлы нужно создать или изменить (Миграция, Модель, Screen, Layout, Filter, Request, Seeder).
    * Определи зависимости задачи (например, для создания Screen управления ролями нужна модель `Role` и настроенные permissions).
    * Если задача зависит от невыполненной функциональности — вернись к п.1 и пересмотри порядок задач или создай заглушку (mock).

3. **Реализация (принцип «от бэкенда к фронтенду»)**

4. **Проверка и интеграция:**
    * **Запусти миграцию:** `php artisan migrate`.
    * **Зарегистрируй маршрут** в `routes/platform.php` и пункт меню в `app/Orchid/PlatformProvider.php`.
    * **Зайди в админ-панель** и проверь функциональность **от начала до конца** (например: создать запись → заполнить все поля → сохранить → отредактировать → удалить).
    * **Проверь в контексте:** Убедись, что новая функциональность не сломала существующую (например, новые поля SEO отображаются на странице редактирования товара).
    * **Настрой права доступа (Permissions),** если задача этого требует. Проверь вход под пользователями с разными ролями.

5. **Формулировка результата или `TODO`:**
    * **Если задача выполнена:** В отчете укажи, что было сделано (например: «Создан Screen `UserScreen` с фильтрацией по роли. Роли подключены через Many-to-Many. Права доступа настройны в `PlatformProvider`»).
    * **Если задача не выполнена или требуется дополнительное действие:**
        * Четко сформулируй **проблему** («При сохранении формы падает ошибка `MassAssignmentException`»).
        * Укажи **причину** («В модели `Post` не указано поле `author_id` в `$fillable`»).
        * Предложи **конкретное решение** или **дополнительное действие** (`TODO: "Добавить 'author_id' в массив $fillable модели Post"`).

## Задачи

[]1. Базовая инфраструктура и безопасность
Поднять Orchid
настроить базовые маршруты routes/platform.php
оформить базовый layout админки (брендинг, меню, хлебные крошки).
Настроить аутентификацию, rate limiting на логин, обязательный HTTPS.
Подключить файловое хранилище (локальный диск) и конфигурацию для spatie/medialibrary.

[]2. RBAC и пользователи
Создать роли: Супер-админ, Админ, Контент-менеджер.
Настроить матрицу прав в Orchid Permissions: контент, формы/заявки, меню, page builder, SEO, импорты, системные настройки, лог аудита.
Seed начальных ролей/пользователей, экраны управления ролями/пользователями.

[]3. Глобальные сущности и общие возможности
Реализовать единый статусный поток “черновик/опубликовано” с предпросмотром (tokenized preview) для всех контентных моделей.
Общая модель SEO-полей (title/description/h1/og) и шаблонов с переменными; механизм override на сущностях.
Поддержка slug/URL-менеджмента с 301-редиректами при смене slug.
Подключить Schema.org шаблонно для товаров/услуг с возможностью override.
Логирование действий админ-пользователей (CRUD/публикации/настройки) через Orchid аудит.

[]4. Контентные модули (CRUD + связи)
Для каждого модуля: модели, миграции, фабрики, Orchid Screen + Layouts, фильтры/поиск, статусы, SEO, предпросмотр.
Катtгории продукции (SEO-страницы) с описанием/баннером.
Товары: галерея, описание, характеристики key→value, связанные кейсы, опционально подборка “Похожие/С этим заказывают”.
Услуги: контент, галерея/медиа, связанные кейсы.
Портфолио (кейсы): галерея, описание, клиент + NDA флаг, дата, связи товары↔кейсы и услуги↔кейсы, блок “Другие кейсы” (по связям/фильтру).
Новости: анонс, дата, контент, медиа.
Статические страницы (в т.ч. Производственные возможности, Проектирование, Контакты, юридические privacy/consent/terms/cookies) с SEO.
Связи: многие-ко-многим для товаров/кейсов и услуг/кейсов; выбор на карточках + автоподбор (по тегам/категориям при наличии).

[]5. Page Builder и глобальные блоки
Реализовать page builder для Главной/статических страниц: секции (продукция, услуги, кейсы, производство-превью, CTA, контакты и пр.), drag/drop порядок.
Глобальные блоки (CTA-формы, контакты и т.п.) с переиспользованием; изменение блока отражается во всех вставках.
Настроить предпросмотр собранных страниц.

[]6. Меню и навигация
Модуль управления верхним/нижним меню: порядок, видимость, вложенность (по необходимости).
Конфигурация роутинга публичной части согласно структуре URL (продукция/услуги/портфолио/новости/поиск и т.д.).
Хлебные крошки генератор (кроме главной).

[]7. Формы и заявки (единый модуль)
Конструктор форм: типы полей, маски, обязательность, чекбокс согласия ПДн с ссылками.
Привязка форм к страницам/сущностям, настройка CTA-блоков.
Валидация: телефон/Email обязательны, антиспам/капча + серверные лимиты.
Фиксация источника: source_url, page_title, utm_*.
Уведомления Email + Telegram с настраиваемыми получателями.
Модель Заявки: тип формы, snapshot полей, статус (Новая/В работе/Закрыта), комментарий менеджера, источник/UTM, экспорт CSV с фильтрами.
Дедупликация для аналитики (уникальные по email/телефону) в отчетах.

[]8. Аналитика и события
Настройки интеграций Яндекс.Метрика/GA (скрипты, ключи).
Отслеживание событий: отправка формы, клики tel:/Telegram/WhatsApp.
Дашборд в админке: конверсия “уникальные посетители → уникальные заявки”, среднее время на сайте, популярные страницы, каналы трафика, сравнение периодов (данные Метрики/GA + собственные заявки).
Базовые системные метрики (ротация логов, бэкапы, статусы очередей/cron).

[]9. Импорт/экспорт
Импорт CSV для товаров, услуг, портфолио, заявок: режимы создать/обновить (по slug/ключу), валидация, отчеты об ошибках; медиа загружается отдельно.
Экспорт CSV из заявок и, при необходимости, контента (с фильтрами).

[]10. Публичная часть (основные страницы и поиск)
Реализация шаблонов для всех публичных URL: хедер/футер с поиском autocomplete, CTA, соцкнопки, хлебные крошки.
Листинги с пагинацией/“показать ещё” (портфолио, новости), фильтры (портфолио по товарам/услугам), поиск с группировкой по типам.
Страницы 404/500, robots.txt, sitemap.xml; корректные редиректы при смене slug.

[]11. Тестирование и приемка
Юнит/фиче-тесты для CRUD, статусов публикации, SEO-override, связей, импорта/экспорта, форм/заявок, RBAC и предпросмотра.
Сквозные проверки публичных маршрутов и поиска.
Чек-лист приемки из ТЗ (контент создаваем без кода, формы сохраняют/уведомляют, связи выводятся, поиск работает, логи фиксируют действия, бэкапы/ротация предусмотрены).
